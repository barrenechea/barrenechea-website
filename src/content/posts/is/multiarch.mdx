---
title: Multi-arch Allt Saman
description: Fer칧alagi칧 fr치 x86/64 heimi til alheims arkitekt칰ra.
pubDate: 2021-09-06T00:00:00Z
img: ~/assets/images/arm-x86.svg
imgAlt: Tveir fl칬gur, annar merktur "x86" og hinn "ARM".
translatedBy: gpt-4-1106-preview
checksum: fa8c71668cd9e14e1349122d69ac1a0696e5a23dff0182b9145a50b33a68cbf6
---

룐gar vi칧 byrju칧um a칧 leggja grunninn hj치 [Finalis](https://www.finalis.com), man 칠g eftir 쭀칤 a칧 hafa hugmyndina um a칧 pr칩fa AWS's Graviton.
료칧 var ekki framkv칝manlegt 치ri칧 2018 치n 쬰ss a칧 byggja hlutina sj치lfur. Flj칩tlega fram 칤 t칤mann, 쬬칧 er 2022, og vi칧 (sem samf칠lag) eigum enn 칤 erfi칧leikum me칧 a칧 finna ARMv8 stu칧ning 칤 Dockerhub myndum.

En 치ri칧 2020 ger칧ist eitthva칧 st칩rt: Apple tilkynnti um skipti Macs yfir til Apple Silicon me칧 2 치ra t칤maramma.

Hj치 Finalis, vi칧 h칬ldum okkur vi칧 Apple b칰na칧 fyrir hugb칰na칧arr칩un. 뤢 f칝r칧 Unix-l칤kt st칳rikerfi og fr치b칝ra skj치- og hlj칩칧g칝칧i fyrir a칧 horfa 치 kvikmyndir e칧a hva칧 sem er 游.

츼ri칧 2020 h칩fst ni칧urtalning. Ef vi칧 vildum halda 치fram a칧 칬칧last n칳ja Apple t칝ki 칤 framt칤칧inni, 쬿rfti Finalis a칧 ver칧a marg-arkitekt칰r.

## Docker

룐gar Apple gaf 칰t M1, og vi칧 fengum einn, Docker var a칧 byrja a칧 "komast af" me칧 쬬칧, en Docker 치 ARM 치tti 칤 sumum vandam치lum 칤 eldri 칰tg치fum einfaldlega vegna 쬰ss a칧 v칠lin var veri칧 a칧 pr칩fa (af okkur, frumkv칬칧lum r칩unarinnar).

S칤칧ar virtist sem allt v칝ri 칤 lagi: ri칧ja a칧ila t칩l - flestar af nau칧synlegum myndum voru 쬰gar 칤 bo칧i fyrir ARM64, en ekki allar. [browserless](https://github.com/browserless/chrome) var s칰 sem 칠g byrja칧i a칧 takast 치 vi칧 til a칧 f치 hana bygg칧a 치 ARM64, og 쭀칤 sendi 칠g [pull request](https://github.com/browserless/chrome/pull/1847) me칧 l치gmarksbreytingarnar sem 쬿rfti til a칧 l치ta 쬬칧 virka.

Me칧 ri칧ja a칧ila t칩lum hulinn, 쬬칧 var bara spurning um a칧 gera viss um a칧 Docker bygg칧i okkar eigin myndir fyrir ARM64. "H칝, 쮂 notar TypeScript; 쬬칧 칝tti bara a칧 virka!"... J칰, svo lengi sem h치칧leikar 쮂셡ir 쬿rfa ekki a칧 hla칧a ni칧ur tv칤undum 치 me칧an 쮂 keyrir `npm install`.

A칧alvandam치li칧? Engar tv칤undir eru veittar fyrir ARM64, sem ney칧ir til a칧 byggja tv칤und 치 me칧an 쮂 keyrir `npm install` me칧 `make` (eftir-uppsetningar handrit?). Fr치 stillingarsj칩narhorni, sm치 치st 칤 sumum af okkar `Dockerfile` skr치m var allt sem 쬿rfti og 쬬칧 leysti allt.

## Pipelines

A칧 vinna me칧 GitHub Actions og takast 치 vi칧 marg-arkitekt칰r, 쮂 hefur tv칝r valkosti: keyra tvo samhli칧a runners (einn byggir fyrir x86/64 og hinn fyrir arm64), e칧a keyra einn runner fyrir b치칧ar arkitekt칰r.

칄g valdi seinni kostinn til a칧 tilraunast me칧, 칤 gegnum [docker buildx](https://docs.docker.com/build/buildx/). Eftir uppsetningarlei칧beiningarnar fyrir [build-push-action](https://github.com/docker/build-push-action#path-context) getur칧u flj칩tt fengi칧 virkan pipeline.

A칧 leyfa buildx a칧 me칧h칬ndla marg-arkitekt칰r byggingu leyfir 쮂r a칧 칳ta 치 Dockerhub 치n 쬰ss a칧 쬿rfa a칧 takast 치 vi칧 mismunandi merki fyrir mismunandi arkitekt칰r. 칐ll 쮂셡 merki VER칋A marg-arkitekt칰r samh칝f칧.

Gallinn er byggingart칤minn: a칧 hafa tvo samhli칧a runners 치 vi칧eigandi arkitekt칰rum v칝ri miklu hra칧ari, en pipeline myndi 쬿rfa a칧 me칧h칬ndla sameiningu ni칧ursta칧nanna 칤 eitt merki. _A칧eins ef 쮂 hefur 치hyggjur af 쭀칤 a칧 gera 쬬칧 au칧veldara fyrir neytendur a칧 finna r칠tta mynd._
